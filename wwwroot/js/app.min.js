var app=angular.module("ullo",["ngRoute","ngAnimate"]);app.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{controller:"SignInCtrl",templateUrl:"templates/signin-test.html",title:"Sign In"}).when("/signin",{controller:"SignInCtrl",templateUrl:"templates/signin-test.html",title:"Sign In"}).when("/stream",{controller:"TestCtrl",templateUrl:"templates/test.html",title:"TestCtrl"}).when("/dishes/:dishId",{controller:"TestCtrl",templateUrl:"templates/test.html",title:"Dishes"}).when("/test",{controller:"TestCtrl",templateUrl:"templates/temp.html",title:"HomePage"}).when("/404",{controller:"TestCtrl",templateUrl:"templates/test.html",title:"Errore 404"}),e.otherwise("/404"),t.html5Mode(!0)}]),app.controller("SignInCtrl",["$scope","$timeout","$http","$location",function(e,t,n,r){e.model={},e.signin=function(){e.signinFormError=null,e.signinFormBchusy=!0,e.clicked=!0,t(function(){n.post("http://ulloapi.wslabs.it/api/users/signin",e.model).then(function(e){console.log("signin",e),r.path("/stream")},function(t){console.log("error",t),e.signinFormError={message:t.message}})["finally"](function(){t(function(){e.signinFormBusy=!1},3e3)}),e.clicked=!1},1e3)}}]),app.controller("TestCtrl",["$scope","$timeout","$http",function(e,t,n){e.model={label:"Carica"},setTimeout(function(){e.model.label="Carica Stream"},1e3),e.item={id:117,user:{userName:"Fabio Ottaviani",facebookId:"10153341954226947",route:"fabio-ottaviani"},dish:{price:5,isVeganFriendly:!1,yes:1,no:0,created:"2016-04-27T19:13:45.497",vote:{dishId:19,like:!0,created:"2016-04-27T19:14:00.497"},categories:[{id:2,name:"Piadine",key:"piadine"}],id:19,name:"Pizza Margherita",key:"pizzaMargherita"},picture:{guid:"8fe99743-4ed3-46de-ba13-2c1bd7a45ffe",created:"2016-04-27T19:13:41.02",id:20,name:"8fe99743-4ed3-46de-ba13-2c1bd7a45ffe",route:"/Media/Files/8fe99743-4ed3-46de-ba13-2c1bd7a45ffe.jpg",key:"8Fe997434Ed346DeBa132C1bd7a45ffe"},created:"2016-04-27T19:13:45.497"},e.loadStream=function(){n.get("http://ulloapi.wslabs.it/api/stream/anonymous").then(function(t){e.items=t.data},function(e){console.log("error",e)})}}]),app.animation(".navigation",["$rootScope","$animate",function(e,t){function n(){return!i}function r(){return o&&o.isForward}var o=null,i=null,a={type:dynamics.bezier,points:[{x:0,y:0,cp:[{x:.509,y:.007}]},{x:1,y:1,cp:[{x:.566,y:.997}]}],duration:500};return e.$on("$routeChangeSuccess",function(e,t,n){o=n.$$route,i=t.$$route}),{enter:function(e,t){if(n())dynamics.css(e[0],{translateY:0,opacity:0,scale:1.2}),dynamics.animate(e[0],{translateY:0,opacity:1,scale:1},a);else if(r()){var o=e[0].offsetWidth;dynamics.css(e[0],{translateX:-o}),dynamics.animate(e[0],{translateX:0},a)}else{var o=e[0].offsetWidth;dynamics.css(e[0],{translateX:o}),dynamics.animate(e[0],{translateX:0},a)}t()},leave:function(e,t){if(r()){var n=e[0].offsetWidth;dynamics.css(e[0],{translateX:0}),dynamics.animate(e[0],{translateX:n},a)}else{var n=e[0].offsetWidth;dynamics.css(e[0],{translateX:0}),dynamics.animate(e[0],{translateX:-n},a)}setTimeout(t,1e3)}}}]);var LESSON=!0,CONFIG={CLIENT:0===window.location.href.indexOf("http://ulloclient.wslabs.it")?"http://ulloclient.wslabs.it":"http://dev.ullowebapp:8081",API:LESSON||0===window.location.href.indexOf("http://ulloclient.wslabs.it")?"http://ulloapi.wslabs.it":"https://localhost:44302",FACEBOOK_APP_ID:0===window.location.href.indexOf("http://ulloclient.wslabs.it")?"1054303094614120":"1062564893787940",assetTypeEnum:{Unknown:0,Picture:1},IOS:!!navigator.userAgent.match(/iPad|iPhone|iPod/g)};app.constant("APP",CONFIG),app.config(["$routeProvider","$locationProvider",function(e,t){e.when("/stream",{title:"Stream",templateUrl:"templates/stream.html",controller:"StreamCtrl",controllerAs:"streamCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]}}).when("/dishes/:dishId",{title:"Dish",templateUrl:"templates/dish.html",controller:"DishCtrl",controllerAs:"dishCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/categories/:categoryId",{title:"Category",templateUrl:"templates/category.html",controller:"CategoryCtrl",controllerAs:"categoryCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/users/:userRoute",{title:"User",templateUrl:"templates/user.html",controller:"UserCtrl",controllerAs:"userCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/post",{title:"Add Post",templateUrl:"templates/post.html",controller:"PostCtrl",controllerAs:"postCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/settings",{title:"Settings",templateUrl:"templates/settings.html",controller:"SettingsCtrl",controllerAs:"settingsCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/splash",{title:"Splash",templateUrl:"templates/splash.html",controller:"SplashCtrl",controllerAs:"splashCtrl"}).when("/signin",{title:"Sign In",templateUrl:"templates/signin.html",controller:"SigninCtrl",controllerAs:"signinCtrl"}).when("/signup",{title:"Sign Up",templateUrl:"templates/signup.html",controller:"SignupCtrl",controllerAs:"signupCtrl"}).when("/test",{title:"Test",templateUrl:"templates/dishes.html",controller:"TestCtrl",controllerAs:"testCtrl"}).when("/404",{title:"Error 404",templateUrl:"404.html"}),e.otherwise("/stream"),t.html5Mode(!0)}]),app.config(["$httpProvider",function(e){e.defaults.withCredentials=!0}]),app.directive("onTap",["$timeout",function(e){return{restrict:"A",link:function(t,n,r,o){function i(t){console.log("ciao"),n.addClass("tapped"),e(function(){n.removeClass("tapped")},500)}function a(){n.on("touchstart mousedown",i)}function s(){n.off("touchstart mousedown",i)}t.$on("$destroy",function(){s()}),a()}}}]),app.directive("animate",["$timeout",function(e){return{restrict:"A",link:function(t,n,r,o){n.addClass("animated");var i=["fadeIn"],a=["1"];for(void 0!==r.animate&&(i=r.animate.split(",")),void 0!==r.delay&&(a=r.delay.split(",")),angular.forEach(a,function(e,t){a[t]=parseInt(e)});a.length<i.length;)a.push(a[a.length-1]+50);var s=i.join(" ");for(-1!==i[0].indexOf("In")&&(n.addClass("invisible"),s+=" invisible");i.length;){var l=a.shift(),u=i.shift();e(function(){n.removeClass(s),n.addClass(u),0===i.length&&-1!==u.indexOf("Out")&&e(function(){n.addClass("invisible")},1e3)},l)}}}}]),app.directive("scrollable",["$parse","$compile","$window","$timeout","Utils",function(e,t,n,r,o){return{restrict:"A",link:function(r,i,a,s){function l(){A||P&&(A=!0,r.$apply(P).then()["finally"](function(){O=W=0,setTimeout(function(){c(),A=!1},500)}))}function u(){A||q&&(A=!0,r.$apply(q).then()["finally"](function(){var e=i[0].offsetHeight-G[0].offsetHeight;O=W=e>L?L:L+j,setTimeout(function(){c(),A=!1},500)}))}function c(){x=!1,C=!1,F=null,S=null,$()}function f(){B+=j,L-=j,W>B?l():L>W&&u()}function d(e){if(B=0,L=i[0].offsetHeight-G[0].offsetHeight,x?(W=O+F.y-S.y,f()):N&&(W+=N,N*=.75,C&&f(),Math.abs(N)<.05&&(N=0,W=O=E,C=!1,m())),W=Math.min(B,W),W=Math.max(L,W),E+=(W-E)/4,H.transform("translate3d(0,"+E.toFixed(2)+"px,0)"),H.set(G[0]),M){if(x||C||N){var t=E/(i[0].offsetHeight-G[0].offsetHeight);t=Math.max(0,Math.min(1,t)),D=(i[0].offsetHeight-X[0].offsetHeight)*t,z+=(0-z)/4;var n=Math.max(1,Math.round(t*M.rows.length));X.html(n+"/"+M.count)}else z+=(45-z)/4;R.transform("translate3d("+z.toFixed(2)+"px,"+D.toFixed(2)+"px,0)"),R.set(X[0])}}function p(){function e(t){d(t),U=window.requestAnimationFrame(e,i)}U||e()}function m(){U&&(window.cancelAnimationFrame(U),U=null)}function h(e){A||(O=W=E,N=0,S=o.getTouch(e),C=!1,k(),p())}function g(e){T=F,F=o.getTouch(e),x=!0}function v(e){F&&T&&(N+=4*(F.y-T.y)),O=W=E,x=!1,F=null,S=null,T=null,I=o.getTouch(e),$()}function y(e){if(!A){e||(e=event);var t=e.deltaY<0||e.wheelDelta>0||e.deltaY<0?1:-1;N+=5*t,C=!0,p()}}function w(){i.on("touchstart mousedown",h),i.on("wheel",_)}function b(){i.off("touchstart mousedown",h),i.off("wheel",_)}function k(){angular.element(n).on("touchmove mousemove",g),angular.element(n).on("touchend mouseup",v)}function $(){angular.element(n).off("touchmove mousemove",g),angular.element(n).off("touchend mouseup",v)}n.ondragstart=function(){return!1};var x,C,A,S,F,T,I,U,P,q,M,j=150,O=0,W=0,E=0,B=0,L=0,N=0,z=45,D=0;void 0!==a.onTop&&(P=e(a.onTop,null,!0)),void 0!==a.onBottom&&(q=e(a.onBottom,null,!0)),void 0!==a.showIndicatorFor&&(M=r.$eval(a.showIndicatorFor)),i.attr("unselectable","on").addClass("unselectable");var R,G=i.find("div"),H=new o.Style,X=null;M&&(X=angular.element('<div class="indicator"></div>'),R=new o.Style,i.append(X),t(X.contents())(r),R.transform("translate3d("+z.toFixed(2)+"px,"+D.toFixed(2)+"px,0)"),R.set(X[0]));var _=o.throttle(y,25);r.$on("$destroy",function(){b()}),w()}}}]),app.directive("ngImg",["$parse","$timeout",function(e,t){return{restrict:"A",link:function(t,n,r,o){var i=e(r.ngImg,null,!0),a=new Image;a.onload=function(){r.$set("src",this.src),setTimeout(function(){n.addClass("loaded")},10)},a.load=function(e){n.removeClass("loaded"),this.src=e},t.$watch(i,function(e){e?a.load(e):r.$set("src",null)})}}}]),app.directive("ngImgWorker",["$parse","WebWorker",function(e,t){var n=new t("/js/workers/loader.min.js");return{restrict:"A",link:function(e,t,r,o){function i(e){function o(e){r.$set("src",e),setTimeout(function(){t.addClass("loaded")},100)}t.removeClass("loaded"),n.post({url:e}).then(function(e){o(e.url)},function(e){o(null)})}var a=e.$eval(r.ngImgWorker);a?i(a):r.$set("src",null)}}}]),app.directive("control",[function(){return{restrict:"A",replace:!0,template:function(e,t){var n=t.form||"Form",r=t.title||"Untitled",o=t.placeholder||r,i=r.replace(/[^0-9a-zA-Z]/g,"").split(" ").join(""),a=n+"."+i,s=' ng-focus="'+a+'.hasFocus=true" ng-blur="'+a+'.hasFocus=false"',l="",u=t.label?t.label:"name",c=t.key?t.key:"id",f=t.model;if(t.required){switch(l='<span ng-messages="'+(t.readonly?"":"("+n+".$submitted || "+a+".$touched) && ")+n+"."+i+'.$error" role="alert"><span ng-message="required" class="label-error animated flash"> &larr; required</span>',t.control){case"password":l+='<span ng-message="minlength" class="label-error animated flash"> &larr; at least 6 chars</span>';break;case"email":l+='<span ng-message="email" class="label-error animated flash"> &larr; incorrect</span>';break;case"number":l+='<span ng-message="number" class="label-error animated flash"> &larr; enter a valid number</span>'}void 0!==t.match&&(l+='<span ng-message="match" class="label-error animated flash"> &larr; not matching</span>'),l+="</span>"}else l=" (optional)";var d="<div "+(t.readonly?' class="readonly" ':"")+' ng-class="{ focus: '+a+".hasFocus, success: "+a+".$valid, error: "+a+".$invalid && (form.$submitted || "+a+".$touched), empty: !"+a+'.$viewValue }"><label for="'+i+'" class="control-label">'+r+l+"</label>";switch(t.control){case"checkbox":d='<div class="checkbox">',d+='<span class="checkbox-label">'+r+l+"</span>",d+='<span class="switch"><input id="'+i+'" name="'+i+'" type="checkbox" ng-model="'+f+'" '+(t.required?'required="true"':"")+' class="toggle toggle-round-flat"><label for="'+i+'"></label></span>',d+="</div>";break;case"select":var p=t.number?"item."+c+" as item."+u+" for item in "+t.source:"item."+u+" for item in "+t.source+" track by item."+c;d+='<select name="'+i+'" class="form-control" ng-model="'+f+'" ng-options="'+p+'" '+(t.number?"convert-to-number":"")+" "+(t.required?'required="true"':"")+'><option value="" disabled selected hidden>'+o+"</option></select>";break;case"autocomplete":var m=t.canCreate?t.canCreate:!1,h=t.flatten?t.flatten:!1,g=t.queryable?t.queryable:!1,v=t.onSelected?' on-selected="'+t.onSelected+'"':"";d+='<input name="'+i+'" ng-model="'+f+'" type="hidden" '+(t.required?"required":"")+">",d+='<div control-autocomplete="'+t.source+'" model="'+f+'" label="'+u+'"  key="'+c+'" can-create="'+m+'" flatten="'+h+'" queryable="'+g+'" placeholder="'+o+'" on-focus="'+a+'.hasFocus=true" on-blur="'+a+'.hasFocus=false"'+v+"></div>";break;case"textarea":d+='<textarea name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+o+'" '+(t.required?"required":"")+' rows="'+(t.rows?t.rows:"1")+'"'+s+"></textarea>";break;case"datetime-local":o==r?o="yyyy-MM-ddTHH:mm:ss":null,d+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+o+'" type="datetime-local"'+(t.required?" required":"")+(t.readonly?" readonly":"")+s+">";break;case"password":d+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+o+'" type="password" ng-minlength="6" '+(t.required?"required":"")+s+">";break;case"email":d+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+o+'" type="email" '+(t.required?"required":"")+s+">";break;case"number":d+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+o+'" type="text"'+(t.required?" required":"")+(t.readonly?" readonly":"")+s+' validate-type="number">';break;case"text":default:d+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+o+'" type="text"'+(t.required?" required":"")+(t.readonly?" readonly":"")+s+">"}return d+"</div>"},link:function(e,t,n,r){}}}]),app.directive("controlAutocomplete",["$parse","$window","$timeout","Utils",function(e,t,n,r){var o=5;return{restrict:"A",scope:{service:"=controlAutocomplete",canCreate:"=",flatten:"=",queryable:"=",model:"=",label:"@",key:"@"},template:function(e,t){var n="<div>";return n+='   <input class="form-control" ng-model="phrase" ng-model-options="{ debounce: 150 }" placeholder="'+t.placeholder+'" type="text" ng-focus="onFocus()">',n+='   <ul class="form-autocomplete" ng-show="items.length">',n+='       <li ng-repeat="item in items" ng-class="{ active: active == $index }" ng-click="onSelect(item)">',n+='           <span>{{item.NameA}}<span class="token">{{item.NameB}}</span>{{item.NameC}}</span>',n+="       </li>",n+="   </ul>",n+="</div>"},link:function(i,a,s,l){function u(){return i.model?i.flatten?i.model:i.model[F]:null}function c(e){i.items.length=0,i.count=0,i.phrase=e||null,S.val(i.phrase)}function f(){var e=null;return-1!=i.active&&i.items.length>i.active&&(e=i.items[i.active]),e}function d(e){i.canCreate&&(i.flatten?T===F&&(i.model=e):(i.model={},i.model[F]=e))}function p(){var e=f();e&&i.onSelect(e),i.$apply()}function m(){i.active--,i.active<0&&(i.active=i.items.length-1),i.$apply()}function h(){i.active++,0==i.items.length?i.active=-1:i.active>=i.items.length&&(i.active=0),i.$apply()}function g(e){i.items=e.items,i.count=e.count,angular.forEach(i.items,function(e,t){var n=e[F],r=n.toLowerCase().indexOf(i.phrase.toLowerCase());e.NameA=n.substr(0,r),e.NameB=n.substr(r,i.phrase.length),e.NameC=n.substr(r+i.phrase.length,n.length-(r+i.phrase.length))})}function v(e){var t=0,n=[];i.phrase.length>1&&angular.forEach(e.items,function(e,r){var a=e[F];-1!==a.toLowerCase().indexOf(i.phrase.toLowerCase())&&(n.length<o&&n.push(e),t++)}),g({count:t,items:n})}function y(){i.phrase=S.val(),i.active=-1,d(i.phrase),i.queryable?i.service.setPhrase(i.phrase).then(function(e){i.items=e.items,i.count=e.count},function(e){console.log("Search.queryable.error",i.phrase,e)})["finally"](function(){}):(v({count:i.service.length,items:i.service}),i.$apply())}function w(e){switch(e.keyCode){case 9:case 13:if(p(),i.items.length)return e.preventDefault?e.preventDefault():null,!1;break;case 38:m();break;case 40:h()}}function b(e){switch(e.keyCode){case 9:case 13:break;case 39:break;case 37:break;case 38:break;case 40:break;default:y.call(this)}}function k(e){return null===r.getClosest(e.target,"[control-autocomplete]")&&i.$apply(function(){i.onBlur()}),!0}function $(){S.on("keydown",w),S.on("keyup",b),angular.element(t).on("mouseup touchend",k)}function x(){S.off("keydown",w),S.off("keyup",b),angular.element(t).off("mouseup touchend",k)}function C(){I||($(),I=!0)}var A=e(s.onSelected),S=a.find("input"),F=i.label?i.label:"name",T=i.key?i.key:"id";i.phrase=u(),i.count=0,i.items=[],i.active=-1,i.maxItems=i.maxItems||Number.POSITIVE_INFINITY,i.onFocus=function(){void 0!==s.onFocus&&i.$parent.$eval(s.onFocus),S.val()===u()&&S.val(null)},i.onBlur=function(){void 0!==s.onBlur&&i.$parent.$eval(s.onBlur),c(u())},i.onSelect=function(e){i.queryable?i.service.setItem(e).then(function(e){A({$item:e},i.$parent,{$event:{}}),n(function(){i.flatten?i.model=e[T]:(i.model=i.model||{},angular.extend(i.model,e)),i.onBlur()},1)}):(A({$item:e},i.$parent,{$event:{}}),i.flatten?i.model=e[T]:(i.model=i.model||{},angular.extend(i.model,e)),i.onBlur())},i.$on("$destroy",function(){x()});var I=!1;i.$watch("service",function(e){e&&(e.length||i.queryable)&&C()}),i.$watchCollection("model",function(e){e&&(i.flatten&&F===T?(i.phrase=e,S.val(i.phrase)):e[F]&&(i.phrase=e[F],S.val(i.phrase)))})}}}]),app.directive("validateType",function(){return{require:"ngModel",link:function(e,t,n,r){var o=n.validateType;switch(o){case"number":r.$parsers.unshift(function(e){return r.$setValidity(o,-1!==String(e).indexOf(Number(e).toString())),e})}}}}),app.filter("customCurrency",["$filter",function(e){var t=e("currency");return function(e,n){return t(e*n.ratio,n.formatting)}}]),app.filter("customSize",["APP",function(e){return function(t){if(e.unit===e.units.IMPERIAL){var n=Math.floor(t/12);return t%=12,t=Math.round(10*t)/10,(n?n+"' ":"")+(t+"''")}var r=Math.floor(t*e.size.ratio),o=t*e.size.ratio*100%100;return o=Math.round(10*o)/10,(r?r+"m ":"")+(o+"cm")}}]),app.filter("customWeight",["APP",function(e){return function(t){if(e.unit===e.units.IMPERIAL){if(1>t){var n=16*t;return n=Math.round(10*n)/10,n?n+"oz ":""}return t=Math.round(100*t)/100,t?t+"lb ":""}var r=Math.floor(t*e.weight.ratio/1e3),o=t*e.weight.ratio%1e3;return o=Math.round(10*o)/10,(r?r+"kg ":"")+(o+"g")}}]),app.filter("customNumber",["$filter",function(e){var t=e("number");return function(e,n,r){return r=r||"",e?t(e,n)+r:"-"}}]),app.filter("customDate",["$filter",function(e){var t=e("date");return function(e,n,r){return e?t(e,n,r):"-"}}]),app.filter("customTime",["$filter",function(e){return function(e,t){return e?Utils.parseTime(e):t?t:"-"}}]),app.filter("customDigital",["$filter",function(e){return function(e,t){return e?Utils.parseHour(e):t?t:"-"}}]),app.filter("customString",["$filter",function(e){return function(e,t){return e?e:t?t:"-"}}]),app.filter("customEnum",function(){return function(e){return e+=1,10>e?"0"+e:e}}),app.value("UserRoles",[{name:"Guest",id:1},{name:"User",id:2},{name:"Supervisor",id:3},{name:"Admin",id:4}]),app.value("UserRolesEnum",{Guest:1,User:2,Supervisor:3,Admin:4}),app.factory("User",["UserRolesEnum",function(e){function t(e){e?angular.extend(this,e):null}return t.prototype={isAdmin:function(){return this.role===e.Admin},isUser:function(e){return this.email===e.email},picture:function(e){e=e||"sm";var t;switch(e){case"sm":t=50;break;case"md":t=300}return this.facebookId?"https://graph.facebook.com/"+this.facebookId+"/picture?width="+t+"&height="+t+"&type=square":"/img/avatar-default.png"},backgroundPicture:function(e){return"background-image: url("+this.picture(e)+");"}},t}]),app.factory("FacebookService",["$q","APP",function(e,t){function n(){}function r(e,t){n.authResponse=null,"connected"===e.status?(n.authResponse=e.authResponse,t.resolve(e)):"not_authorized"===e.status?t.reject(e):t.reject(e)}return n.FB=function(){var t=e.defer();return void 0!==window.FB?t.resolve(window.FB):n.init().then(function(e){t.resolve(window.FB)},function(e){t.reject(e)}),t.promise},n.getFacebookMe=function(){var t=e.defer();return n.FB().then(function(e){e.api("/me",{fields:"id,name,first_name,last_name,email,gender,picture,cover,link"},function(e){!e||e.error?t.reject("Error occured"):t.resolve(e)})}),t.promise},n.getPictureMe=function(){var t=e.defer();return n.FB().then(function(e){e.api("/me/picture",{width:300,height:300,type:"square"},function(e){!e||e.error?t.reject("Error occured"):t.resolve(e)})}),t.promise},n.getLoginStatus=function(){var t=e.defer();return n.FB().then(function(e){e.getLoginStatus(function(e){r(e,t)})}),t.promise},n.login=function(){var t=e.defer();return n.FB().then(function(e){e.login(function(e){r(e,t)},{scope:"public_profile,email"})}),t.promise},n.logout=function(){var t=e.defer();return n.FB().then(function(e){e.logout(function(e){t.resolve(e)})}),t.promise},n.deletePermissions=function(){var t=e.defer();return n.FB().then(function(e){e.api("/me/permissions","delete",function(e){t.resolve(e)})}),t.promise},n.init=function(){var n=e.defer();window.fbAsyncInit=function(){FB.init({appId:t.FACEBOOK_APP_ID,status:!0,cookie:!0,xfbml:!0,version:"v2.5"}),n.resolve(FB)};try{!function(e,t,n){var r,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(r,o))}(document,"script","facebook-jssdk")}catch(r){n.reject(r)}return n.promise},n}]),app.factory("Users",["$q","$http","$location","$timeout","APP","LocalStorage","User",function(e,t,n,r,o,i,a){function s(){}var l=null;return s.prototype={},s.currentUser=function(){return l},s.getCurrentUser=function(){var n=e.defer();return l?n.resolve(l):t.get(o.API+"/api/users/current/").then(function(e){e&&e.data?(l=new a(e.data),n.resolve(l)):n.resolve(null)},function(e){n.reject(e)}),n.promise},s.isLogged=function(){var t=e.defer();return s.getCurrentUser().then(function(e){e&&e.isAuthenticated?t.resolve(e):t.reject()},function(e){t.reject(e)}),t.promise},s.isAdmin=function(){var t=e.defer();return s.getCurrentUser().then(function(e){e&&e.isAuthenticated&&e.isAdmin?t.resolve(e):t.reject()},function(e){t.reject(e)}),t.promise},s.isLoggedOrGoTo=function(t){var r=e.defer();return s.getCurrentUser().then(function(e){e&&e.isAuthenticated?r.resolve(e):(r.reject(),n.path(t))},function(e){r.reject(e),n.path(t)}),r.promise},s.isAdminOrGoTo=function(t){var r=e.defer();return s.getCurrentUser().then(function(e){e&&e.isAuthenticated&&e.isAdmin?r.resolve(e):(r.reject(),n.path(t))},function(e){r.reject(e),n.path(t)}),r.promise},s.signup=function(n){var r=e.defer();return t.post(o.API+"/api/users/signup/",n).then(function(e){l=new a(e.data),r.resolve(l)},function(e){r.reject(e)}),r.promise},s.signin=function(n){var r=e.defer();return t.post(o.API+"/api/users/signin/",n).then(function(e){l=new a(e.data),r.resolve(l)},function(e){r.reject(e)}),r.promise},s.signInWithFacebook=function(n){var r=e.defer();return t.post(o.API+"/api/users/signinwithfacebook/",n).then(function(e){l=new a(e.data),r.resolve(l)},function(e){r.reject(e)}),r.promise},s.signout=function(){var n=e.defer();return t.get(o.API+"/api/users/signout/").then(function(e){l=null,n.resolve(e.data)},function(e){n.reject(e)}),n.promise},s.detail=function(n){var r=e.defer();return t.get(o.API+"/api/users/route/"+n).then(function(e){r.resolve(new a(e.data))},function(e){r.reject(e)}),r.promise},s}]),app.factory("Vector",function(){function e(e,t){this.x=e||0,this.y=t||0}return e.make=function(t,n){return new e(n.x-t.x,n.y-t.y)},e.size=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.normalize=function(t){var n=e.size(t);return t.x/=n,t.y/=n,t},e.incidence=function(e,t){var n=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);return n},e.distance=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},e.cross=function(e,t){return e.x*t.y-e.y*t.x},e.difference=function(t,n){return new e(n.x-t.x,n.y-t.y)},e.prototype={size:function(){return e.size(this)},normalize:function(){return e.normalize(this)},incidence:function(t){return e.incidence(this,t)},cross:function(t){return e.cross(this,t)},towards:function(e,t){return t=t||.125,this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},friction:function(e){return this.x*=e,this.y*=e,this},copy:function(t){return new e(this.x,this.y)},toString:function(){return"{"+this.x+","+this.y+"}"}},e}),app.factory("Utils",["Vector",function(e){function t(t,n){var r=new e;if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var o=null,i=t.originalEvent?t.originalEvent:t,a=i.touches.length?i.touches:i.changedTouches;a&&a.length&&(o=a[0]),o&&(r.x=o.pageX,r.y=o.pageY)}else"click"!=t.type&&"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(r.x=t.pageX,r.y=t.pageY);return n&&(r.s=e.difference(n,r)),r.type=t.type,r}function n(t,n){var r=t[0].getBoundingClientRect(),o=new e(r.left,r.top);return e.difference(o,n)}function r(e,t){var n,r;for(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]?(n=e,!0):!1});null!==e;){if(r=e.parentElement,null!==r&&r[n](t))return r;e=r}return null}function o(e,t,n){var r,o,i,a=null,l=0;n||(n={});var u=function(){l=n.leading===!1?0:s(),a=null,i=e.apply(r,o),a||(r=o=null)};return function(){var c=s();l||n.leading!==!1||(l=c);var f=t-(c-l);return r=this,o=arguments,0>=f||f>t?(a&&(clearTimeout(a),a=null),l=c,i=e.apply(r,o),a||(r=o=null)):a||n.trailing===!1||(a=setTimeout(u,f)),i}}function i(){}!function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),o=Math.max(0,16-(r-e)),i=window.setTimeout(function(){t(r+o)},o);return e=r+o,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var a=function(){var e="transform",t="webkitTransform",n=document.createElement("DIV");return"undefined"!=typeof n.style[e]?["webkit","moz","o","ms"].every(function(t){var r="-"+t+"-transform";return"undefined"!=typeof n.style[r]?(e=r,!1):!0}):e="undefined"!=typeof n.style[t]?"-webkit-transform":void 0,e}(),s=Date.now||function(){return(new Date).getTime()},l=function(){function e(){this.props={scale:1,hoverScale:1,currentScale:1}}return e.prototype={set:function(e){var t=[];angular.forEach(this,function(e,n){"props"!==n&&t.push(n+":"+e)}),e.style.cssText=t.join(";")+";"},transform:function(e){this[i.transformProperty]=e},transformOrigin:function(e,t){this[i.transformProperty+"-origin-x"]=Math.round(1e3*e)/1e3+"%",this[i.transformProperty+"-origin-y"]=Math.round(1e3*t)/1e3+"%"}},e}();return i.transformProperty=a,i.getTouch=t,i.getRelativeTouch=n,i.getClosest=r,i.throttle=o,i.Style=l,i}]),app.factory("WebWorker",["$q","$http",function($q,$http){function WebWorker(e){var t=this;this.callbacks={},this.id=0,this.worker=new Worker(e),this.worker.onmessage=function(e){t.onmessage(e)}}var isWebWorkerSupported="undefined"!=typeof Worker;return isWebWorkerSupported||(window.Worker=function(){function Worker(src){var self=this;$http.get(src,{transformResponse:function(e,t){return e}}).then(function success(response){try{eval("self.o = function(){ function postMessage(e) { self.onmessage({data:e}); }\n "+response.data+" };"),self.object=new self.o,self.object.postMessage=function(e){self.onmessage({data:e})}}catch(e){console.log("Worker error ",e)}},function(e){console.log("Worker not found")})}return Worker.prototype={onmessage:function(e){console.log("Worker not implemented")},postMessage:function(e){this.object.onmessage({data:e})}},Worker}()),WebWorker.prototype={parse:function(e){return JSON.parse(e.data)},stringify:function(e){return JSON.stringify(e)},onmessage:function(e){var t=this.parse(e),n=this.callbacks[t.id];-1!==t.status?n.resolve(t):n.reject(t),delete this.callbacks[t.id]},post:function(e){var t=$q.defer();return e.id=this.id,this.callbacks[this.id.toString()]=t,this.id++,this.worker.postMessage(this.stringify(e)),t.promise}},WebWorker.isSupported=isWebWorkerSupported,WebWorker}]),app.factory("$httpAsync",["$q","$http",function(e,t){function n(t){var r=e.defer(),o=l(t);return o.id=d.toString(),console.log("wrap",o),f[o.id]=r,d++,c.postMessage(n.stringify(o)),r.promise}function r(e){return e>=200&&300>e}function o(){return Object.create(null)}function i(e){return"string"==typeof e}function a(e){function t(e,t){e&&(r[e]=r[e]?r[e]+", "+t:t)}var n,r=o();if(i(e))for(var a=e.split("\n"),s=0;s<a.length;s++){var l=a[s];n=l.indexOf(":"),t(p(m(l.substr(0,n))),m(l.substr(n+1)))}else if(isObject(e))for(var u in e)t(p(u),m(e[u]));return r}function s(e){var t;return function(n){if(t||(t=a(e)),n){var r=t[p(n)];return void 0===r&&(r=null),r}return t}}function l(e){var n={method:"GET",withCredentials:!1,responseType:"json",headers:{},config:{}};n.withCredentials=t.defaults.withCredentials,angular.extend(n.headers,t.defaults.headers.common);var r=(e.method||n.method).toLowerCase();return t.defaults.headers[r]&&angular.extend(n.headers,t.defaults.headers[r]),console.log("defaults",t.defaults),e?e=angular.extend(n,e):n,e}var u="undefined"!=typeof Worker;if(!u)return t;var c=new Worker("/js/workers/http.min.js"),f={},d=0,p=function(e){return i(e)?e.toLowerCase():e},m=function(e){return i(e)?e.trim():e};return n.get=function(e,t){return n(angular.extend({},t||{},{method:"GET",url:e}))},n["delete"]=function(e,t){return n(angular.extend({},t||{},{method:"DELETE",url:e}))},n.head=function(e,t){return n(angular.extend({},t||{},{method:"HEAD",url:e}))},n.post=function(e,t,r){return n(angular.extend({},r||{},{method:"POST",data:t,url:e}))},n.put=function(e,t,r){return n(angular.extend({},r||{},{method:"PUT",data:t,url:e}))},n.patch=function(e,t,r){return n(angular.extend({},r||{},{method:"PATCH",data:t,url:e}))},n.parse=function(e){return JSON.parse(e.data)},n.stringify=function(e){return JSON.stringify(e)},n.isSupported=u,c.onmessage=function(e){var t=n.parse(e);console.log("onmessage",t);var o=f[t.id],i=t.status>=-1?t.status:0,a=s(t.response.headers);(r(i)?o.resolve:o.reject)({data:t.response.data,headers:a,status:t.response.status,statusText:t.response.statusText,config:t.config}),delete f[t.id]},n}]);
//# sourceMappingURL=app.min.js.map
